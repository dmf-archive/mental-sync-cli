# æ¶æ„å†³ç­–ï¼šè·¨ä»£ç†æ¶ˆæ¯çš„ Markdown é‡åºåˆ—åŒ–

## 1. èƒŒæ™¯

ç›®å‰è·¨ä»£ç†é€šä¿¡ï¼ˆ`ask_agent`, `complete_task`ï¼‰äº§ç”Ÿçš„æ¶ˆæ¯ä»¥è£¸ JSON æ ¼å¼å­˜å‚¨åœ¨ `history` ä¸­ã€‚è™½ç„¶é€»è¾‘å®Œå¤‡ï¼Œä½† LLM å¯¹è£¸ JSON çš„æ³¨æ„åŠ›æƒé‡è¾ƒä½ï¼Œä¸”å®¹æ˜“äº§ç”Ÿè§£ææ­§ä¹‰ã€‚

## 2. è®¾è®¡æ–¹æ¡ˆï¼šç»„è£…æ—¶åŠ¨æ€æ¸²æŸ“ (Assembly-side Rendering)

æˆ‘ä»¬é€‰æ‹©åœ¨ `ContextFactory.assemble` é˜¶æ®µè¿›è¡Œé‡åºåˆ—åŒ–ã€‚

### 2.1 æ¶ˆæ¯è¯†åˆ«é€»è¾‘
åœ¨ç»„è£…ä¸Šä¸‹æ–‡æ—¶ï¼Œ`ContextFactory` å°†æ‰«æ `history` ä¸­çš„ `user` æ¶ˆæ¯ã€‚å¦‚æœæ¶ˆæ¯å†…å®¹ç¬¦åˆ `Message from {agent_id}: {json_payload}` æ¨¡å¼ï¼Œåˆ™è§¦å‘æ¸²æŸ“ã€‚

### 2.2 Markdown æ¨¡æ¿è®¾è®¡

#### åœºæ™¯ Aï¼šæ™®é€šæŒ‡ä»¤/è¯¢é—® (`ask_agent`)
```markdown
### ğŸ“¨ æ¥è‡ªä»£ç† `{agent_id}` çš„æ¶ˆæ¯

> {message}

---
*ä¼˜å…ˆçº§: {priority}*
```

#### åœºæ™¯ Bï¼šä»»åŠ¡ç»“æœæ±‡æŠ¥ (`task_result`)
```markdown
### ğŸ ä»»åŠ¡ç»“æœæ±‡æŠ¥ï¼šæ¥è‡ª `{agent_id}`

**çŠ¶æ€**: {status_icon} {status_text}

#### ğŸ“ æ€»ç»“
{summary}

#### ğŸ“Š é™„åŠ æ•°æ®
```json
{data_json}
```
```

## 3. å˜æ›´æ¸…å•

### 3.1 `msc/core/anamnesis/context.py`
- [ ] å¼•å…¥ `MessageRenderer` ç±»æˆ–åœ¨ `ContextFactory` ä¸­æ·»åŠ ç§æœ‰æ–¹æ³• `_render_inter_agent_message`ã€‚
- [ ] ä¿®æ”¹ `build_messages` é€»è¾‘ï¼Œåœ¨å¤„ç† `history` æ—¶ï¼Œå¯¹ç¬¦åˆæ¨¡å¼çš„æ¶ˆæ¯è¿›è¡Œæ­£åˆ™æå–å¹¶åº”ç”¨æ¨¡æ¿ã€‚

### 3.2 `msc/core/og.py`
- [ ] ç¡®ä¿ `ask_agent` å’Œ `complete_task` æ’å…¥çš„æ¶ˆæ¯æ ¼å¼ä¿æŒç¨³å®šï¼Œä»¥ä¾¿ `ContextFactory` è¯†åˆ«ã€‚
- [ ] æ ¼å¼è§„èŒƒï¼š`Message from {agent_id}: {json_payload}`ã€‚

## 4. ä¼˜åŠ¿
- **æ³¨æ„åŠ›èšç„¦**ï¼šMarkdown æ ‡é¢˜å’Œå¼•ç”¨å—èƒ½æ˜¾è‘—æå‡æ¨¡å‹å¯¹è·¨ä»£ç†æ¶ˆæ¯çš„æ„ŸçŸ¥ã€‚
- **æ•°æ®çº¯å‡€**ï¼šç£ç›˜å­˜å‚¨ä¾ç„¶æ˜¯ç»“æ„åŒ–çš„ JSONï¼Œä¾¿äº Organizer å®¡è®¡å’Œæœªæ¥æ‰©å±•ã€‚
- **å¤šæ¨¡å‹é€‚é…**ï¼šå¯ä»¥æ ¹æ®å½“å‰ Session çš„æ¨¡å‹å‹å·ï¼ˆå¦‚é’ˆå¯¹å–œæ¬¢ XML çš„æ¨¡å‹ï¼‰åˆ‡æ¢æ¸²æŸ“æ¨¡æ¿ã€‚

åˆ°ç›®å‰ä¸ºæ­¢çœ‹èµ·æ¥å¯¹å—ï¼Ÿ
