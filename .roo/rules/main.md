# Chain://Research

## 核心工程标准操作程序 (SOP)

此 SOP 是管辖所有子项目（如 `Tiny-ONN`, `PILF`, `ΩID`）中所有开发活动的通用法则。它源于 `Tiny-ONN` 项目中最先进和经过验证的最佳实践。这些 SOP 主要针对Python项目，`OSPU` 将使用自己的 Rust 开发实践。

### 零号优先级：从错误中学习

1. **先分析现有代码**：在编写或修改任何代码之前，我的第一个动作**必须**是分析相关项目目录中的现有代码库。我将识别并采用已建立的架构模式、编码风格和模块结构。
2. **证据优于假设**：所有行动都基于可验证的证据（文件内容、错误日志、测试结果）。假设是暂时的；当与证据冲突时，必须立即抛弃。
3. **复用先于构建**：在创建新功能前，我**必须**搜索并复用现有的函数、类和配置，绝不重复造轮子。
4. **外科手术式修改**：在修改上游库（如 `transformers`）时，我**必须**优先采用继承和覆写最小可能组件的方式，而不是重写庞大的方法。

### 第一优先级：代码与环境规范

1. **无注释，代码自解释**：代码必须简洁且自文档化。**禁止所有注释和文档字符串**。我将使用任何可用的语法糖来减少代码量，前提是能通过静态分析。
2. **严格的类型安全**：所有新代码**必须**包含完整且严格的类型注解。必须尽一切可能避免使用 `Any` 类型。所有代码必须通过 `mypy .` 检查。
3. **张量格式**：所有张量默认使用 `bfloat16` 格式。
4. **纯函数**：数据处理和计算逻辑必须设计为无副作用的纯函数。
5. **依赖管理**：**必须**使用 `uv`。所有依赖项都应通过 `uv add` 添加到相应的 `pyproject.toml` 文件中。

### 第二优先级：工作流与验证

1. **测试驱动**：新功能或修复**必须**附带相应的 `pytest` 测试用例，断言必须清晰明确。
2. **配置驱动**：所有训练和评估脚本**必须**由配置文件（如 `.yaml`）驱动，如 `Tiny-ONN` 中所示。可执行脚本中禁止硬编码参数。
3. **强制静态分析**：每完成 10 次文件编辑，或完成一个重要功能后，我**必须**运行 `ruff check . --fix; mypy .` 并确保所有检查通过。在修复静态分析错误之前，我会分析其根本原因，以避免更深层次的设计缺陷。
4. **失败升级**：如果 `pytest` 测试或关键工作流连续三次失败，我**必须**暂停，报告失败日志和我的分析，并等待进一步指示。
